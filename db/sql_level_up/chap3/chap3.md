# DBMS 와 실행 계획
RDB 를 조작할 때는 SQL이라는 전용 언어를 사용한다.  
사용자는 SQL만 작성하면, DBMS가 SQL을 알아서 처리하고 결과를 제공해준다.  
따라서 사용자는 데이터가 어디에 저장되어 있는지, 어떻게 데이터에 접근 하는지 생각할 필요는 없다.  
어떻게 라는걸 의식하지 않고 사용하기 때문에 성능 문제로 고생하는 경우가 많이 생긴다.  

## 데이터에 접근하는 방법의 결정  
RDB에서 데이터 접근 절차를 결정하는 모듈을 쿼리 평가 엔진 이라고 부른다.  
쿼리 평가 모듈은 파서, 옵티마이저와 같은 여러 개의 서브 모듈로 구성된다. 

- 파서 
파서는 사용자로부터 입력받은 SQL 구문이 올바른지 검사 한다.  
검사를 통과하면 SQL 구문을 정형적인 형식으로 변환해준다.  

- 옵티마이저  
파서를 통과한 쿼리는 옵티마이저로 전송된다.  
옵티마이저는 최적화를 실행 하는데, 최적화의 대상은 데이터 접근법(실행 계획)이다.  
옵티마이저는 인덱스 유무, 데이터 분산 또는 편향 정도, DBMS 내부 매개변수 등을 고려하여  
선택 가능한 실행 계획을 작성, 비용을 연산하고 가장 낮은 실행 계획을 선택한다.

- 카탈로그 매니저  
옵티마이저가 실행 계획을 세울 때 중요한 정보를 제공하는 것이 카탈로그 매니저이다.  
카탈록그는 DBMS의 내부 정보를 모아놓은 테이블로, 테이블 또는 인덱스의 통계 정보가 저장된다. 

- 플랜 평가  
옵티마이저가 SQL 구문에서 여러 개의 실행 계획을 세운 뒤 최적의 실행 결과를 선택하는 것이 플랜 평가이다. 

## 옵티마이저와 통게 정보 
플랜 선택을 옵티마이저에 맡기는 경우, 최적의 플랜이 선택되지 않는 경우가 꽤 많이 생긴다.  
통계 정보가 부족한 경우가 대표적인 원인이다.  

- 테이블의 레코드 수
- 테이블의 필드 수와 크기
- 필드의 카디널리티
- 필드값의 히스토그램(분포)
- 필드 내부의 null 수
- 인덱스 정보

카탈로그는 이러한 정보를 활용하여 실행 계획을 만드는데, 문제가 생기는 경우는 이러한 카탈로그가 실제와 일치하지 않을 때 발생할 수 있다.  
테이블 갱신시에 카탈로그 정보가 갱신되지 않는다면 옵티마이저는 과거의 정보를 바탕으로 실행 계획을 세우기 때문에 잘못된 계획을 세우게 되는 것이다.

## 최적의 실행 계획을 위해 
올바른 통계 정보가 모이는 것은 SQL 성능에 있어 굉장히 중요하다.  
테이블의 데이터가 많이 바뀌면 카탈로그의 통계 정보도 함계 갱신해 줘야 한다.  
통계 정보 갱신은 실행 비용이 굉장히 높은 작업이지만, 최적의 플랜을 위해 필요하다.  
DBMS 마다 정기적으로 통계정보 갱신작업이 수행되는 경우도 있고, 갱신 처리가 수행되는 시점에 통계 정보도 갱신하는 경우도 있다.

